2<GetMasterProduct>
SELECT
 T.SHOP_CODE
,T.PRD_CODE
,M.PRD_NAME
,CAST(SUM(DECODE(T.SALE_YN, 'Y', T.SALE_QTY, 'N', (T.SALE_QTY*-1), 0)) AS NUMERIC(9, 0))  TOT_SALE_QTY
,SUM(DECODE(T.SALE_YN, 'Y', T.SALE_AMT, 'N', (T.SALE_AMT*-1), 0)) TOT_SALE_AMT 		
,SUM(DECODE(T.SALE_YN, 'Y', T.DC_AMT,   'N', (T.DC_AMT*-1), 0))   TOT_DC_AMT 	
,SUM(DECODE(T.SALE_YN, 'Y', T.DCM_SALE_AMT, 'N', (T.DCM_SALE_AMT*-1), 0)) DCM_SALE_AMT 
,SUM(DECODE(T.SALE_YN, 'Y', T.VAT_AMT,   'N', (T.VAT_AMT*-1), 0))   VAT_AMT 
,ROUND( SUM(DECODE(T.SALE_YN, 'Y', T.SALE_AMT, 'N', (T.SALE_AMT*-1), 0)) 
			/ (  SELECT SUM(DECODE(SUB.SALE_YN, 'Y', SUB.SALE_AMT, 'N', (SUB.SALE_AMT*-1), 0))
				   FROM TRN_PRDT SUB
				  WHERE SUB.SHOP_CODE = @SHOP_CODE 
					AND SUB.SALE_DATE BETWEEN  @START_DATE AND @FINISH_DATE  
					GROUP BY SUB.SHOP_CODE
			  )  * 100 , 1) AS OCC_RATE	
FROM TRN_PRDT T
INNER JOIN MST_INFO_PRODUCT M 
ON T.SHOP_CODE = M.SHOP_CODE
AND T.PRD_CODE = M.PRD_CODE
WHERE T.SHOP_CODE = @SHOP_CODE 
AND T.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE 
AND (@POS_NO like '00' OR T.POS_NO = @POS_NO)
GROUP BY T.SHOP_CODE, M.PRD_NAME, T.PRD_CODE
ORDER BY T.SHOP_CODE, M.PRD_NAME, T.PRD_CODE
</GetMasterProduct>
<GetDetailProducts>
SELECT
 T.SALE_DATE 
,CAST(SUM(DECODE(T.SALE_YN, 'Y', T.SALE_QTY, 'N', (T.SALE_QTY*-1), 0)) AS NUMERIC(9, 0))  TOT_SALE_QTY
,SUM(DECODE(T.SALE_YN, 'Y', T.SALE_AMT, 'N', (T.SALE_AMT*-1), 0)) TOT_SALE_AMT
,SUM(DECODE(T.SALE_YN, 'Y', T.DC_AMT,   'N', (T.DC_AMT*-1), 0))   TOT_DC_AMT
,SUM(DECODE(T.SALE_YN, 'Y', T.DCM_SALE_AMT, 'N', (T.DCM_SALE_AMT*-1), 0))   DCM_SALE_AMT 
,SUM(DECODE(T.SALE_YN, 'Y', T.VAT_AMT,   'N', (T.VAT_AMT*-1), 0))   VAT_AMT 
,ROUND( SUM(DECODE(T.SALE_YN, 'Y', T.SALE_AMT, 'N', (T.SALE_AMT*-1), 0)) 
			/NULLIF( (  SELECT SUM(DECODE(SUB.SALE_YN, 'Y', SUB.SALE_AMT, 'N', (SUB.SALE_AMT*-1), 0))
				   FROM TRN_PRDT SUB
				  WHERE SUB.SHOP_CODE = @SHOP_CODE
					AND SUB.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE 
					AND SUB.PRD_CODE = @PRD_CODE
					GROUP BY SUB.SHOP_CODE
			  ),
            0)  * 100 , 1) AS OCC_RATE
FROM TRN_PRDT T 
INNER JOIN MST_INFO_PRODUCT M 
ON T.SHOP_CODE = M.SHOP_CODE 
AND T.PRD_CODE = M.PRD_CODE
WHERE T.SHOP_CODE = @SHOP_CODE 
AND T.SALE_DATE BETWEEN @START_DATE  AND @FINISH_DATE
AND T.PRD_CODE =@PRD_CODE
GROUP BY T.SHOP_CODE, M.PRD_NAME, T.PRD_CODE, T.SALE_DATE 
ORDER BY T.SHOP_CODE, M.PRD_NAME, T.PRD_CODE, T.SALE_DATE 
</GetDetailProducts>
<GetSelngStatus>
SELECT 
 S.SHOP_CODE	    
,S.SALE_DATE 
-- (DECODE(T.SALE_YN, 'Y', T.SALE_AMT, 'N', (T.SALE_AMT*-1), 0))
,SUM(DECODE(@PAY_TYPE_AMT		,
			'CASH_AMT'		, S.CASH_AMT		, 
			'CRD_CARD_AMT'	, S.CRD_CARD_AMT	,		 
			'TK_GFT_AMT'	, S.TK_GFT_AMT	,
			'TK_FOD_AMT'	, S.TK_FOD_AMT	,
			'SP_PAY_AMT'	, S.SP_PAY_AMT	,	
			'TOT_DC_AMT'	, S.TOT_DC_AMT	,	
			TOT_SALE_AMT)) AS TOT_SALE_AMT
FROM SETT_POSACCOUNT S 
WHERE S.SHOP_CODE = @SHOP_CODE
AND S.REGI_SEQ <> '00'
AND (@POS_NO like '00' OR S.POS_NO = @POS_NO)
AND  SUBSTRING(S.SALE_DATE FROM 1 FOR 6) =@CURRENT_DAY
GROUP BY S.SHOP_CODE, S.SALE_DATE
;
</GetSelngStatus>
<GetExcclcSttus>
SELECT 
S.SHOP_CODE		
, SUM(S.REM_CHECK_AMT)	REM_CHECK_AMT 
, SUM(S.REM_W100000_CNT)REM_W100000_CNT	
, SUM(S.REM_W50000_CNT)	REM_W50000_CNT	
, SUM(S.REM_W10000_CNT)	REM_W10000_CNT	
, SUM(S.REM_W5000_CNT)	REM_W5000_CNT	
, SUM(S.REM_W1000_CNT)	REM_W1000_CNT	
, SUM(S.REM_W500_CNT)	REM_W500_CNT	
, SUM(S.REM_W100_CNT)	REM_W100_CNT	
, SUM(S.REM_W50_CNT)	REM_W50_CNT		
, SUM(S.REM_W10_CNT)	REM_W10_CNT		
, SUM(S.REM_CASH_AMT)	REM_CASH_AMT	
, SUM(S.CRD_CARD_CNT)	CRD_CARD_CNT			
, SUM(S.CRD_CARD_AMT)	CRD_CARD_AMT			
, SUM(S.RET_BILL_CNT)	RET_BILL_CNT			
, SUM(S.RET_BILL_AMT)	RET_BILL_AMT			
, SUM(S.CRD_CARD_AMT) 
- SUM(S.RET_BILL_AMT) 	AS CARD_AMT 			
, SUM(S.POS_READY_AMT)		POS_READY_AMT		
, SUM(S.CASH_AMT)			CASH_AMT			
, SUM(S.WEA_IN_CSH_AMT)		WEA_IN_CSH_AMT		
, SUM(S.TK_GFT_SALE_CSH_AMT) TK_GFT_SALE_CSH_AMT
, SUM(S.TK_FOD_SALE_CSH_AMT) TK_FOD_SALE_CSH_AMT
, SUM(S.POS_CSH_IN_AMT)		 POS_CSH_IN_AMT		
, SUM(S.POS_CSH_OUT_AMT)	 POS_CSH_OUT_AMT	
, SUM(S.REPAY_CASH_AMT)		 REPAY_CASH_AMT		
, ( SUM(S.REM_CASH_AMT) 
	- ( SUM(S.POS_READY_AMT) + SUM(S.CASH_AMT) + SUM(S.WEA_IN_CSH_AMT) + SUM(S.TK_GFT_SALE_CSH_AMT) +  SUM(S.TK_GFT_SALE_CSH_AMT) + SUM(S.TK_FOD_SALE_CSH_AMT) + SUM(S.POS_CSH_IN_AMT) )   
    - ( SUM(S.POS_CSH_OUT_AMT) + SUM(S.REPAY_CASH_AMT) )
  ) AS LOSS_CASH_AMT		
, SUM(S.TK_GFT_CNT)			TK_GFT_CNT			
, SUM(S.TK_GFT_UAMT)		TK_GFT_AMT			
, SUM(S.REPAY_TK_GFT_CNT)	REPAY_TK_GFT_CNT	
, SUM(S.REPAY_TK_GFT_AMT)	REPAY_TK_GFT_AMT	
, SUM(S.REM_TK_GFT_AMT)		REM_TK_GFT_AMT		
, SUM(S.LOSS_TK_GFT_AMT)	LOSS_TK_GFT_AMT
,SUM(S.TK_GFT_UAMT) TK_GFT_UAMT,
CAST((SELECT COUNT (*) FROM TRN_CARD WHERE SALE_YN = 'Y' AND SHOP_CODE = @SHOP_CODE AND POS_NO = @POS_NO AND   SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE AND (@REGI_SEQ is null OR REGI_SEQ = @REGI_SEQ)	) AS NUMERIC(9, 0)) AS CARD_S_CNT,
CAST((SELECT COUNT (*) FROM TRN_CARD WHERE SALE_YN = 'N' AND SHOP_CODE = @SHOP_CODE AND POS_NO = @POS_NO AND   SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE AND (@REGI_SEQ is null OR REGI_SEQ = @REGI_SEQ)	)AS NUMERIC(9, 0)) AS CARD_C_CNT,
CAST((SELECT SUM(CASE WHEN card.SALE_YN = 'Y' THEN card.APPR_AMT ELSE 0 END ) AS CARD_S_AMT FROM TRN_CARD  card WHERE card.SALE_YN = 'Y' AND card.SHOP_CODE = @SHOP_CODE AND card.POS_NO = @POS_NO AND   card.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE AND (@REGI_SEQ is null OR REGI_SEQ = @REGI_SEQ)) AS NUMERIC(9, 0)) AS CARD_S_AMT,
CAST((SELECT SUM(CASE WHEN card.SALE_YN = 'N' THEN card.APPR_AMT ELSE 0 END ) AS CARD_S_AMT FROM TRN_CARD  card WHERE card.SALE_YN = 'N' AND card.SHOP_CODE = @SHOP_CODE AND card.POS_NO = @POS_NO AND   card.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE AND (@REGI_SEQ is null OR REGI_SEQ = @REGI_SEQ)) AS NUMERIC(9, 0)) AS CARD_C_AMT
FROM SETT_POSACCOUNT S 
WHERE S.SHOP_CODE = @SHOP_CODE
AND   S.POS_NO = @POS_NO
AND   S.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE  
AND   S.REGI_SEQ <> '00'
AND (@REGI_SEQ is null OR REGI_SEQ = @REGI_SEQ)

GROUP BY S.SHOP_CODE	
</GetExcclcSttus>
<GetDaySettle>
SELECT 
  S.SHOP_CODE		
 ,SUM(S.CST_POINTUSE_AMT) AS CST_POINT_AMT
, SUM(S.TOT_BILL_CNT)	TOT_BILL_CNT
, SUM(S.TOT_SALE_AMT) + SUM(S.RET_BILL_AMT) AS TOTAL_SALE_AMT 
, SUM(S.RET_BILL_AMT)		RET_BILL_AMT	
, SUM(S.TOT_SALE_AMT)		TOT_SALE_AMT	
, SUM(S.TOT_DC_AMT)			TOT_DC_AMT		
, SUM(S.DCM_SALE_AMT)		DCM_SALE_AMT	
, SUM(S.VAT_SALE_AMT)		VAT_SALE_AMT	
, SUM(S.NO_VAT_SALE_AMT  )  NO_VAT_SALE_AMT  
, SUM(S.CASH_AMT)			CASH_AMT		
, SUM(S.CRD_CARD_AMT)		CRD_CARD_AMT	
, SUM(S.WES_AMT)			WES_AMT			
, SUM(S.TK_GFT_AMT)			TK_GFT_AMT		
, SUM(S.JCD_CARD_AMT)		JCD_CARD_AMT	
, SUM(S.CST_POINTUSE_AMT)	CST_POINTUSE_AMT
, SUM(S.TK_FOD_AMT)			TK_FOD_AMT		
, SUM(S.RFC_AMT)			RFC_AMT			
, SUM(S.SP_PAY_AMT)			SP_PAY_AMT		
, SUM(S.EGIFT_AMT)			EGIFT_AMT		
, SUM(S.PCD_CARD_AMT)		PCD_CARD_AMT	
, SUM(S.PPC_CARD_AMT)		PPC_CARD_AMT	
, SUM(S.MCP_AMT)			MCP_AMT			
, SUM(S.RFC_AMT)			RFC_AMT			
, SUM(S.DEPOSIT_AMT)		DEPOSIT_AMT		
, SUM(S.REFUND_AMT)			REFUND_AMT		
, SUM(S.DC_GEN_AMT)			DC_GEN_AMT		
, SUM(S.DC_SVC_AMT)			DC_SVC_AMT		
, SUM(S.DC_JCD_AMT)			DC_JCD_AMT		
, SUM(S.DC_CPN_AMT)			DC_CPN_AMT		
, SUM(S.DC_CST_AMT)			DC_CST_AMT		
, SUM(S.DC_TFD_AMT)			DC_TFD_AMT		
, SUM(S.DC_PRM_AMT)			DC_PRM_AMT		
, SUM(S.DC_CRD_AMT)			DC_CRD_AMT		
, SUM(S.DC_PACK_AMT)		DC_PACK_AMT		
, SUM(S.TOT_BILL_CNT)       TOT_BILL_CNT		
, SUM(S.CST_POINTSAVE_CNT)	CST_POINTSAVE_CNT	
, SUM(S.CST_POINTSAVE_AMT)	CST_POINTSAVE_AMT	
, SUM(S.CST_POINTUSE_CNT)	CST_POINTUSE_CNT	
, SUM(S.CST_POINTUSE_AMT)	CST_POINTUSE_AMT	
, SUM(S.RFC_CNT)			RFC_CNT				
, SUM(S.RFC_AMT)			RFC_AMT	
,SUM(S.VAT_AMT) VAT_AMT 
,SUM(PRE_PNT_SALE_CRD_AMT ) AS PRE_PNT_SALE_CRD_AMT 
FROM SETT_POSACCOUNT S 
WHERE S.SHOP_CODE = @SHOP_CODE
AND   S.POS_NO = @POS_NO
AND   S.REGI_SEQ <> '00'
AND   S.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE  
AND (@REGI_SEQ like '00' OR S.REGI_SEQ = @REGI_SEQ)
GROUP BY S.SHOP_CODE	
</GetDaySettle>
<GetCardDistinct>
 SELECT 
  T.PUR_CRDCP_NAME         CompanyName   
,SUM(1)        SaleCount  
,SUM(DECODE(T.SALE_YN, 'Y', T.APPR_AMT, 'N', (T.APPR_AMT*-1), 0)) Amount 	
FROM TRN_CARD T 
WHERE T.SHOP_CODE = @SHOP_CODE
AND   T.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE 
GROUP BY T.SHOP_CODE, T.PUR_CRDCP_NAME 
</GetCardDistinct>
<GetMonthlyData>
SELECT 
 S.SHOP_CODE	   
,SUM(S.CASH_AMT)			CASH_AMT			
,SUM(S.CRD_CARD_AMT)		CRD_CARD_AMT		
,SUM(S.JCD_CARD_AMT)		JCD_CARD_AMT		
,SUM(S.WES_AMT)				WES_AMT				
,SUM(S.TK_GFT_AMT)			TK_GFT_AMT			
,SUM(S.CST_POINTUSE_AMT) 	CST_POINTUSE_AMT	
,SUM(S.TOT_DC_AMT) 	        TOT_DC_AMT	
,SUM(S.TOT_SALE_AMT)
- SUM(S.CASH_AMT) 
- SUM(S.CRD_CARD_AMT)
- SUM(S.JCD_CARD_AMT)
- SUM(S.WES_AMT)
- SUM(S.TK_GFT_AMT)
- SUM(S.CST_POINTUSE_AMT) ETC_AMT	
,SUM(DECODE(@PAY_TYPE_AMT		,
			'CASH_AMT'		, S.CASH_AMT		, 
			'CRD_CARD_AMT'	, S.CRD_CARD_AMT	,		 
			'TK_GFT_AMT'	, S.TK_GFT_AMT	,
			'TK_FOD_AMT'	, S.TK_FOD_AMT	,
			'SP_PAY_AMT'	, S.SP_PAY_AMT	,		
			'TOT_DC_AMT'	, S.TOT_DC_AMT	,	
			TOT_SALE_AMT)) AS TOT_SALE_AMT
FROM SETT_POSACCOUNT S 
WHERE S.SHOP_CODE = @SHOP_CODE
AND  S.REGI_SEQ <> '00'
AND (@POS_NO like '00' OR S.POS_NO = @POS_NO)
AND  SUBSTRING(S.SALE_DATE FROM 1 FOR 6) = @Month
GROUP BY S.SHOP_CODE
</GetMonthlyData>
<GetMiddleCardAppr>
select       K.BILL_NO 
			,'POS' as EQM_TYPE 
			,K.APPR_PROC_FLAG as "APPR_IDT_TYPE"
			,K.APPR_LOG_NO as "APPR_IDT_NO"
			,K.SALE_YN 
			,K.APPR_NO 
			,CASE WHEN K.SALE_YN = 'N' THEN K.APPR_AMT * -1 ELSE K.APPR_AMT END AS  APPR_AMT 
from	SETT_POSACCOUNT S inner join TRN_CARD K on	S.SHOP_CODE = K.SHOP_CODE and 
													S.SALE_DATE	= K.SALE_DATE and
													S.POS_NO	= K.POS_NO	  and
													S.REGI_SEQ  = K.REGI_SEQ
where	S.SHOP_CODE  = @SHOP_CODE  and
        S.POS_NO = @POS_NO and 
		S.SALE_DATE  BETWEEN  @START_DATE AND @FINISH_DATE   and
		S.REGI_SEQ	  = @REGI_SEQ  and
		(@SALE_YN IS NULL OR K.SALE_YN = @SALE_YN)
</GetMiddleCardAppr>
<GetMiddleCashAppr>
select       BILL_NO 
			,'POS' as EQM_TYPE  
			,APPR_IDT_TYPE
			,APPR_IDT_NO
			,SALE_YN 
			,APPR_NO 
			,CASE WHEN SALE_YN = 'N' THEN APPR_AMT * -1 ELSE APPR_AMT END AS  APPR_AMT 
from	SETT_POSACCOUNT S left join TRN_CASHREC	 C on	S.SHOP_CODE = C.SHOP_CODE and 
														S.SALE_DATE	= C.SALE_DATE and
														S.POS_NO	= C.POS_NO	  and
														S.REGI_SEQ  = C.REGI_SEQ
where	S.SHOP_CODE  = @SHOP_CODE  and
        S.POS_NO = @POS_NO and 
		S.SALE_DATE  BETWEEN  @START_DATE AND @FINISH_DATE   and
		(@REGI_SEQ  is null OR S.REGI_SEQ = @REGI_SEQ)    and
		APPR_AMT <>0
</GetMiddleCashAppr>
<GetMiddleGiftCard1>
select  
		 G.SALE_YN
		,G.BILL_NO
		,G.TK_GFT_UAMT
		,G.TK_GFT_AMT
		,M.TK_GFT_NAME
		,G.TK_GFT_SALE_FLAG 
		,COUNT(G.TK_GFT_CODE) AS TK_GFT_CNT 
from	SETT_POSACCOUNT S left join TRN_GIFT G on	S.SHOP_CODE = G.SHOP_CODE
											   and  S.SALE_DATE = G.SALE_DATE
											   and  S.POS_NO	  = G.POS_NO	 
											   and  S.REGI_SEQ  = G.REGI_SEQ 
						  left join MST_INFO_TICKET M on G.SHOP_CODE     = M.SHOP_CODE
													  and	 G.TK_GFT_CODE   = M.TK_GFT_CODE
													  and M.TK_CLASS_FLAG ='G'
where	 S.SHOP_CODE  = @SHOP_CODE  and	 G.TK_GFT_UAMT  <> 0	and		    
         S.POS_NO = @POS_NO and 
		 S.SALE_DATE  BETWEEN @START_DATE AND @FINISH_DATE    and
		 S.REGI_SEQ	  = @REGI_SEQ  and  	
		 (@SALE_YN IS NULL OR G.SALE_YN = @SALE_YN)
 GROUP  BY 
 G.SALE_YN
,G.BILL_NO
,G.TK_GFT_UAMT
,G.TK_GFT_AMT
,M.TK_GFT_NAME
,G.TK_GFT_SALE_FLAG 
</GetMiddleGiftCard1>
select 
		 G.SALE_YN
		,G.BILL_NO
		,S.TK_GFT_AMT
		,G.APPR_AMT
		,M.TK_GFT_NAME
		,COUNT(G.TK_GFT_CODE) AS TK_GFT_CNT 
		,G.PPC_PROC_FLAG
from	SETT_POSACCOUNT S left join TRN_EGIFT G on	  S.SHOP_CODE = G.SHOP_CODE
												and   S.SALE_DATE = G.SALE_DATE
												and   S.POS_NO	   = G.POS_NO	 
												and   S.REGI_SEQ  = G.REGI_SEQ 
						  left join MST_INFO_TICKET M on G.SHOP_CODE     = M.SHOP_CODE
where	 S.SHOP_CODE  = @SHOP_CODE  and
         S.POS_NO = @POS_NO and 
		 S.SALE_DATE  BETWEEN @START_DATE AND @FINISH_DATE    and
		 S.REGI_SEQ	  = @REGI_SEQ   and
		 (@SALE_YN IS NULL OR G.SALE_YN = @SALE_YN)
 GROUP  BY 
 G.SALE_YN
,G.BILL_NO
,S.TK_GFT_AMT
,G.APPR_AMT
,M.TK_GFT_NAME
,G.PPC_PROC_FLAG
</GetMiddleGiftCard2>
<GetDayData>
SELECT 
 S.SHOP_CODE	   
,SUM(S.CASH_AMT)			CASH_AMT			
,SUM(S.CRD_CARD_AMT)		CRD_CARD_AMT		
,SUM(S.JCD_CARD_AMT)		JCD_CARD_AMT		
,SUM(S.WES_AMT)				WES_AMT				
,SUM(S.TK_GFT_AMT)			TK_GFT_AMT			
,SUM(S.CST_POINTUSE_AMT) 	CST_POINTUSE_AMT	
,SUM(S.TOT_DC_AMT) 	        TOT_DC_AMT	
,SUM(S.TOT_SALE_AMT)
- SUM(S.CASH_AMT)
- SUM(S.CRD_CARD_AMT)
- SUM(S.JCD_CARD_AMT)
- SUM(S.WES_AMT)
- SUM(S.TK_GFT_AMT)
- SUM(S.CST_POINTUSE_AMT) ETC_AMT		 
,SUM(DECODE(@PAY_TYPE_AMT		,
			'CASH_AMT'		, S.CASH_AMT		, 
			'CRD_CARD_AMT'	, S.CRD_CARD_AMT	,		 
			'TK_GFT_AMT'	, S.TK_GFT_AMT	,
			'TK_FOD_AMT'	, S.TK_FOD_AMT	,
			'SP_PAY_AMT'	, S.SP_PAY_AMT	,	
			'TOT_DC_AMT'	, S.TOT_DC_AMT	,	
			TOT_SALE_AMT)) AS TOT_SALE_AMT
FROM SETT_POSACCOUNT S
WHERE S.SHOP_CODE = @SHOP_CODE
AND  S.REGI_SEQ <> '00'
AND (@POS_NO like '00' OR S.POS_NO = @POS_NO)
AND S.SALE_DATE BETWEEN @DAY AND @DAY 
GROUP BY S.SHOP_CODE
</GetDayData>
<GetClassData>
SELECT 
 S.SHOP_CODE	    
,SUM(S.CASH_AMT)			CASH_AMT			
,SUM(S.CRD_CARD_AMT)		CRD_CARD_AMT		
,SUM(S.JCD_CARD_AMT)		JCD_CARD_AMT		
,SUM(S.WES_AMT)				WES_AMT				
,SUM(S.TK_GFT_AMT)			TK_GFT_AMT			
,SUM(S.CST_POINTUSE_AMT) 	CST_POINTUSE_AMT	
,SUM(S.TOT_DC_AMT) 	        TOT_DC_AMT	
,SUM(S.TOT_SALE_AMT)
- SUM(S.CASH_AMT)
- SUM(S.CRD_CARD_AMT)
- SUM(S.JCD_CARD_AMT)
- SUM(S.WES_AMT)
- SUM(S.TK_GFT_AMT)
- SUM(S.CST_POINTUSE_AMT) ETC_AMT		
,SUM(DECODE(@PAY_TYPE_AMT		,
			'CASH_AMT'		, S.CASH_AMT		, 
			'CRD_CARD_AMT'	, S.CRD_CARD_AMT	,		 
			'TK_GFT_AMT'	, S.TK_GFT_AMT	,
			'TK_FOD_AMT'	, S.TK_FOD_AMT	,
			'SP_PAY_AMT'	, S.SP_PAY_AMT	,		
			'TOT_DC_AMT'	, S.TOT_DC_AMT	,		
			TOT_SALE_AMT)) AS TOT_SALE_AMT
FROM SETT_POSACCOUNT S 
WHERE S.SHOP_CODE = @SHOP_CODE
AND  S.REGI_SEQ <> '00'
AND (@POS_NO like '00' OR S.POS_NO = @POS_NO)
AND  SUBSTRING(S.SALE_DATE FROM 1 FOR 6) = @MONTH
AND EXTRACT(WEEKDAY FROM CAST(SUBSTRING(S.SALE_DATE FROM 1 FOR 4) 
						 || '-' || SUBSTRING(S.SALE_DATE FROM 5 FOR 2) 
					     || '-' || SUBSTRING(S.SALE_DATE FROM 7 FOR 2) AS date) 
 				) LIKE @RANK 
GROUP BY S.SHOP_CODE
;
</GetClassData>
<GetWeekData>
SELECT 
 S.SHOP_CODE	  
 , 
SUM(S.CASH_AMT)			CASH_AMT			
,SUM(S.CRD_CARD_AMT)		CRD_CARD_AMT		
,SUM(S.JCD_CARD_AMT)		JCD_CARD_AMT		
,SUM(S.WES_AMT)				WES_AMT				
,SUM(S.TK_GFT_AMT)			TK_GFT_AMT			
,SUM(S.CST_POINTUSE_AMT) 	CST_POINTUSE_AMT	
,SUM(S.TOT_DC_AMT) 	        TOT_DC_AMT	
,SUM(S.TOT_SALE_AMT)
- SUM(S.CASH_AMT)
- SUM(S.CRD_CARD_AMT)
- SUM(S.JCD_CARD_AMT)
- SUM(S.WES_AMT)
- SUM(S.TK_GFT_AMT)
- SUM(S.CST_POINTUSE_AMT) ETC_AMT			
,SUM(DECODE(@PAY_TYPE_AMT		,
			'CASH_AMT'		, S.CASH_AMT		, 
			'CRD_CARD_AMT'	, S.CRD_CARD_AMT	,		 
			'TK_GFT_AMT'	, S.TK_GFT_AMT	,
			'TK_FOD_AMT'	, S.TK_FOD_AMT	,
			'SP_PAY_AMT'	, S.SP_PAY_AMT	,		
			'TOT_DC_AMT'	, S.TOT_DC_AMT	,		
			TOT_SALE_AMT)) AS TOT_SALE_AMT
FROM SETT_POSACCOUNT S 
WHERE S.SHOP_CODE = @SHOP_CODE 
AND  S.REGI_SEQ <> '00'
AND (@POS_NO like '00' OR S.POS_NO = @POS_NO)
AND S.SALE_DATE BETWEEN @START_DATE AND @FINISH_DATE 
GROUP BY S.SHOP_CODE
;
</GetWeekData>

<GetPaymentSellingStats>
SELECT
		PAY_TYPE_FLAG  as Pay_Flag
		,count (*) as Qty
		,sum (PAY_AMT) as Pay_Amt
		,ROUND( SUM(DECODE(SALE_YN, 'Y', PAY_AMT, 'N', (PAY_AMT*-1), 0)) 
			/ (  SELECT SUM(DECODE(SUB.SALE_YN, 'Y', SUB.PAY_AMT, 'N', (SUB.PAY_AMT*-1), 0))
				   FROM TRN_TENDERSEQ SUB
				    WHERE SUB.SHOP_CODE = @SHOPCODE
					AND SUB.SALE_DATE BETWEEN @DATEFROM AND @DATETO
					AND SUB.SALE_YN = 'Y' )   , 3) AS OCC_RATE	
FROM TRN_TENDERSEQ T
WHERE T.SHOP_CODE = @SHOPCODE 
AND SALE_DATE BETWEEN @DATEFROM AND @DATETO
AND (@POSNO IS NULL OR POS_NO = @POSNO)
AND SALE_YN = 'Y' 
AND PAY_AMT <> 0
GROUP BY PAY_TYPE_FLAG
ORDER BY PAY_TYPE_FLAG
</GetPaymentSellingStats>

<GetPaymentDetailStats>
SELECT  
		SALE_DATE  
		,count (*) as Qty
		,sum (PAY_AMT) as Pay_Amt
		,ROUND( SUM(DECODE(SALE_YN, 'Y', PAY_AMT, 'N', (PAY_AMT*-1), 0)) 
			/ (  SELECT SUM(DECODE(SUB.SALE_YN, 'Y', SUB.PAY_AMT, 'N', (SUB.PAY_AMT*-1), 0))
				   FROM TRN_TENDERSEQ SUB
				    WHERE SUB.SHOP_CODE = @SHOPCODE
				    AND PAY_TYPE_FLAG = @PAYCODE
					AND SUB.SALE_DATE BETWEEN @DATEFROM AND @DATETO
					AND SUB.SALE_YN = 'Y' )   , 3) AS OCC_RATE	
FROM TRN_TENDERSEQ T
WHERE T.SHOP_CODE = @SHOPCODE 
AND SALE_DATE BETWEEN @DATEFROM AND @DATETO
AND PAY_TYPE_FLAG = @PAYCODE
AND (@POSNO IS NULL OR POS_NO = @POSNO)
AND SALE_YN = 'Y' 
AND PAY_AMT <> 0
GROUP BY SALE_DATE
ORDER BY SALE_DATE
</GetPaymentDetailStats>

<ProductSaleOfDay>
select
sum (SALE_QTY) as Qty,
sum (SALE_AMT) as Sale_amt,
PRD_NAME as ProdName
from	TRN_PRDT T inner join MST_INFO_PRODUCT M on T.PRD_CODE  = M.PRD_CODE
												and T.SHOP_CODE = M.SHOP_CODE
where	T.SHOP_CODE = @SHOPCODE
	and	T.SALE_DATE = @SALEDATE
	and	T.POS_NO	= @POSNO
	and (@PAYTYPE IS NULL OR T.PRD_TYPE_FLAG = @PAYTYPE)
Group by PRD_NAME
</ProductSaleOfDay>

<SaleByTypeOfDay>
select
SALE_QTY,
SALE_AMT,
PRD_NAME
from	SETT_POSACCOUNT S 
where	SHOP_CODE = @SHOPCODE
	and	SALE_DATE = @SALEDATE
	and	POS_NO	= @POSNO
</SaleByTypeOfDay>