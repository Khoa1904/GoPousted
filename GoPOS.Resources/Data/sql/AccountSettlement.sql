<GetSettlementInfo>

SELECT 
			 S.SHOP_CODE
			,S.SALE_DATE
			,S.POS_NO
			,S.REGI_SEQ
			,S.EMP_NO
			,S.EMP_NO || ' ' ||'-'|| ' ' || E.EMP_NAME  AS "EMP_DISPLAY"   
			,S.CLOSE_FLAG
			,S.OPEN_DT
			,S.CLOSE_DT
			,S.TOT_BILL_CNT
			,S.TOT_SALE_AMT
			,S.TOT_DC_AMT
			,S.SVC_TIP_AMT
			,S.TOT_ETC_AMT
			,S.DCM_SALE_AMT
			,S.VAT_SALE_AMT
			,S.VAT_AMT
			,S.NO_VAT_SALE_AMT
			,S.NO_TAX_SALE_AMT
			,S.RET_BILL_CNT
			,S.RET_BILL_AMT
			,S.VISIT_CST_CNT
			,S.POS_READY_AMT
			,S.POS_CSH_IN_AMT
			,S.POS_CSH_OUT_AMT
			,S.WEA_IN_CSH_AMT
			,S.WEA_IN_CRD_AMT
			,S.TK_GFT_SALE_CSH_AMT
			,S.TK_GFT_SALE_CRD_AMT
			,S.TK_FOD_SALE_CSH_AMT
			,S.TK_FOD_SALE_CRD_AMT
			,S.CASH_CNT
			,S.CASH_AMT
			,S.CASH_BILL_CNT
			,S.CASH_BILL_AMT
			,S.CRD_CARD_CNT
			,S.CRD_CARD_AMT
			,S.WES_CNT
			,S.WES_AMT
			,S.TK_GFT_CNT
			,S.TK_GFT_AMT
			,S.TK_FOD_CNT
			,S.TK_FOD_AMT
			,S.CST_POINT_CNT
			,S.CST_POINT_AMT
			,S.JCD_CARD_CNT
			,S.JCD_CARD_AMT
			,S.RFC_CNT
			,S.RFC_AMT
			,S.DC_GEN_CNT
			,S.DC_GEN_AMT
			,S.DC_SVC_CNT
			,S.DC_SVC_AMT
			,S.DC_JCD_CNT
			,S.DC_JCD_AMT
			,S.DC_CPN_CNT
			,S.DC_CPN_AMT
			,S.DC_CST_CNT
			,S.DC_CST_AMT
			,S.DC_TFD_CNT
			,S.DC_TFD_AMT
			,S.DC_PRM_CNT
			,S.DC_PRM_AMT
			,S.DC_CRD_CNT
			,S.DC_CRD_AMT
			,S.DC_PACK_CNT
			,S.DC_PACK_AMT
			,S.REM_CHECK_CNT
			,S.REM_CHECK_AMT
			,S.REM_W100000_CNT
			,S.REM_W50000_CNT
			,S.REM_W10000_CNT
			,S.REM_W5000_CNT
			,S.REM_W1000_CNT
			,S.REM_W500_CNT
			,S.REM_W100_CNT
			,S.REM_W50_CNT
			,S.REM_W10_CNT
			,S.REM_CASH_AMT
			,S.REM_TK_GFT_CNT
			,S.REM_TK_GFT_AMT
			,S.REM_TK_FOD_CNT
			,S.REM_TK_FOD_AMT
			,S.ETC_TK_FOD_AMT
			,S.LOSS_CASH_AMT
			,S.LOSS_TK_GFT_AMT
			,S.LOSS_TK_FOD_AMT
			,S.REPAY_CASH_CNT
			,S.REPAY_CASH_AMT
			,S.REPAY_TK_GFT_CNT
			,S.REPAY_TK_GFT_AMT
			,S.MCP_CNT
			,S.MCP_AMT
			,S.PCD_CARD_CNT
			,S.PCD_CARD_AMT
			,S.PPC_CARD_AMT
			,S.PPC_CARD_CNT
			,S.PPC_CARD_SALE_CSH_AMT
			,S.PPC_CARD_SALE_CRD_AMT
			,S.TAX_RFND_CNT
			,S.TAX_RFND_AMT
			,S.TAX_RFND_FEE
			,S.DC_TAX_CNT
			,S.DC_TAX_AMT
			,S.O2O_CNT
			,S.O2O_AMT
			,S.EGIFT_CNT
			,S.EGIFT_AMT
			,S.SP_PAY_AMT
			,S.SP_PAY_CNT
			,S.DEPOSIT_AMT
			,S.DEPOSIT_CNT
			,S.REFUND_AMT
			,S.REFUND_CNT
			,S.SEND_FLAG
			,S.SEND_DT
			,S.INSERT_DT
FROM		SETT_POSACCOUNT	S
INNER JOIN	MST_INFO_EMP	E	ON	S.EMP_NO = E.EMP_NO
WHERE		S.SHOP_CODE = @SHOP_CODE
AND 		S.POS_NO	= @POS_NO
--AND			S.SALE_DATE	= @SALE_DATE
--AND			S.REGI_SEQ	= @REGI_SEQ

</GetSettlementInfo>

<OpenNewBusinessDay>
INSERT INTO	SETT_POSACCOUNT	(
				 SHOP_CODE
				,SALE_DATE
				,POS_NO
				,REGI_SEQ
				,EMP_NO
				,CLOSE_FLAG
				,OPEN_DT
				,CLOSE_DT
				,TOT_BILL_CNT
				,TOT_SALE_AMT
				,TOT_DC_AMT
				,SVC_TIP_AMT
				,TOT_ETC_AMT
				,DCM_SALE_AMT
				,VAT_SALE_AMT
				,VAT_AMT
				,NO_VAT_SALE_AMT
				,NO_TAX_SALE_AMT
				,RET_BILL_CNT
				,RET_BILL_AMT
				,VISIT_CST_CNT
				,POS_READY_AMT
				,POS_CSH_IN_AMT
				,POS_CSH_OUT_AMT
				,WEA_IN_CSH_AMT
				,WEA_IN_CRD_AMT
				,TK_GFT_SALE_CSH_AMT
				,TK_GFT_SALE_CRD_AMT
				,TK_FOD_SALE_CSH_AMT
				,TK_FOD_SALE_CRD_AMT
				,CASH_CNT
				,CASH_AMT
				,CASH_BILL_CNT
				,CASH_BILL_AMT
				,CRD_CARD_CNT
				,CRD_CARD_AMT
				,WES_CNT
				,WES_AMT
				,TK_GFT_CNT
				,TK_GFT_AMT
				,TK_FOD_CNT
				,TK_FOD_AMT
				,CST_POINT_CNT
				,CST_POINT_AMT
				,JCD_CARD_CNT
				,JCD_CARD_AMT
				,RFC_CNT
				,RFC_AMT
				,DC_GEN_CNT
				,DC_GEN_AMT
				,DC_SVC_CNT
				,DC_SVC_AMT
				,DC_JCD_CNT
				,DC_JCD_AMT
				,DC_CPN_CNT
				,DC_CPN_AMT
				,DC_CST_CNT
				,DC_CST_AMT
				,DC_TFD_CNT
				,DC_TFD_AMT
				,DC_PRM_CNT
				,DC_PRM_AMT
				,DC_CRD_CNT
				,DC_CRD_AMT
				,DC_PACK_CNT
				,DC_PACK_AMT
				,REM_CHECK_CNT
				,REM_CHECK_AMT
				,REM_W100000_CNT
				,REM_W50000_CNT
				,REM_W10000_CNT
				,REM_W5000_CNT
				,REM_W1000_CNT
				,REM_W500_CNT
				,REM_W100_CNT
				,REM_W50_CNT
				,REM_W10_CNT
				,REM_CASH_AMT
				,REM_TK_GFT_CNT
				,REM_TK_GFT_AMT
				,REM_TK_FOD_CNT
				,REM_TK_FOD_AMT
				,ETC_TK_FOD_AMT
				,LOSS_CASH_AMT
				,LOSS_TK_GFT_AMT
				,LOSS_TK_FOD_AMT
				,REPAY_CASH_CNT
				,REPAY_CASH_AMT
				,REPAY_TK_GFT_CNT
				,REPAY_TK_GFT_AMT
				,MCP_CNT
				,MCP_AMT
				,PCD_CARD_CNT
				,PCD_CARD_AMT
				,PPC_CARD_AMT
				,PPC_CARD_CNT
				,PPC_CARD_SALE_CSH_AMT
				,PPC_CARD_SALE_CRD_AMT
				,TAX_RFND_CNT
				,TAX_RFND_AMT
				,TAX_RFND_FEE
				,DC_TAX_CNT
				,DC_TAX_AMT
				,O2O_CNT
				,O2O_AMT
				,EGIFT_CNT
				,EGIFT_AMT
				,SP_PAY_AMT
				,SP_PAY_CNT
				,DEPOSIT_AMT
				,DEPOSIT_CNT
				,REFUND_AMT
				,REFUND_CNT
				,SEND_FLAG
				,SEND_DT
				,INSERT_DT )
VALUES	(
				 @SHOP_CODE		
				,@SALE_DATE		
				,@POS_NO		
				,'01'			
				,@EMP_NO		
				,'1'			
				,@OPEN_DT		
				,@CLOSE_DT		
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,0				
				,CASE WHEN @POS_READY_AMT IS NOT NULL THEN @POS_READY_AMT ELSE 0 END
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,0
				,'0'
				,@SEND_DT
				,@INSERT_DT )

</OpenNewBusinessDay>

<OpenInterimShift>
INSERT INTO	SETT_POSACCOUNT	(
				 SHOP_CODE
				,SALE_DATE
				,POS_NO
				,REGI_SEQ
				,EMP_NO
				,CLOSE_FLAG
				,OPEN_DT
				,CLOSE_DT
				,TOT_BILL_CNT
				,TOT_SALE_AMT
				,TOT_DC_AMT
				,SVC_TIP_AMT
				,TOT_ETC_AMT
				,DCM_SALE_AMT
				,VAT_SALE_AMT
				,VAT_AMT
				,NO_VAT_SALE_AMT
				,NO_TAX_SALE_AMT
				,RET_BILL_CNT
				,RET_BILL_AMT
				,VISIT_CST_CNT
				,POS_READY_AMT
				,POS_CSH_IN_AMT
				,POS_CSH_OUT_AMT
				,WEA_IN_CSH_AMT
				,WEA_IN_CRD_AMT
				,TK_GFT_SALE_CSH_AMT
				,TK_GFT_SALE_CRD_AMT
				,TK_FOD_SALE_CSH_AMT
				,TK_FOD_SALE_CRD_AMT
				,CASH_CNT
				,CASH_AMT
				,CASH_BILL_CNT
				,CASH_BILL_AMT
				,CRD_CARD_CNT
				,CRD_CARD_AMT
				,WES_CNT
				,WES_AMT
				,TK_GFT_CNT
				,TK_GFT_AMT
				,TK_FOD_CNT
				,TK_FOD_AMT
				,CST_POINT_CNT
				,CST_POINT_AMT
				,JCD_CARD_CNT
				,JCD_CARD_AMT
				,RFC_CNT
				,RFC_AMT
				,DC_GEN_CNT
				,DC_GEN_AMT
				,DC_SVC_CNT
				,DC_SVC_AMT
				,DC_JCD_CNT
				,DC_JCD_AMT
				,DC_CPN_CNT
				,DC_CPN_AMT
				,DC_CST_CNT
				,DC_CST_AMT
				,DC_TFD_CNT
				,DC_TFD_AMT
				,DC_PRM_CNT
				,DC_PRM_AMT
				,DC_CRD_CNT
				,DC_CRD_AMT
				,DC_PACK_CNT
				,DC_PACK_AMT
				,REM_CHECK_CNT
				,REM_CHECK_AMT
				,REM_W100000_CNT
				,REM_W50000_CNT
				,REM_W10000_CNT
				,REM_W5000_CNT
				,REM_W1000_CNT
				,REM_W500_CNT
				,REM_W100_CNT
				,REM_W50_CNT
				,REM_W10_CNT
				,REM_CASH_AMT
				,REM_TK_GFT_CNT
				,REM_TK_GFT_AMT
				,REM_TK_FOD_CNT
				,REM_TK_FOD_AMT
				,ETC_TK_FOD_AMT
				,LOSS_CASH_AMT
				,LOSS_TK_GFT_AMT
				,LOSS_TK_FOD_AMT
				,REPAY_CASH_CNT
				,REPAY_CASH_AMT
				,REPAY_TK_GFT_CNT
				,REPAY_TK_GFT_AMT
				,MCP_CNT
				,MCP_AMT
				,PCD_CARD_CNT
				,PCD_CARD_AMT
				,PPC_CARD_AMT
				,PPC_CARD_CNT
				,PPC_CARD_SALE_CSH_AMT
				,PPC_CARD_SALE_CRD_AMT
				,TAX_RFND_CNT
				,TAX_RFND_AMT
				,TAX_RFND_FEE
				,DC_TAX_CNT
				,DC_TAX_AMT
				,O2O_CNT
				,O2O_AMT
				,EGIFT_CNT
				,EGIFT_AMT
				,SP_PAY_AMT
				,SP_PAY_CNT
				,DEPOSIT_AMT
				,DEPOSIT_CNT
				,REFUND_AMT
				,REFUND_CNT
				,SEND_FLAG
				,SEND_DT
				,INSERT_DT )
VALUES(
				 @SHOP_CODE
				,@SALE_DATE
				,@POS_NO
				,CAST(@REGI_SEQ AS INTEGER) + 1 
				,@EMP_NO
				,@CLOSE_FLAG
				,@OPEN_DT
				,@CLOSE_DT
				,@TOT_BILL_CNT
				,@TOT_SALE_AMT
				,@TOT_DC_AMT
				,@SVC_TIP_AMT
				,@TOT_ETC_AMT
				,@DCM_SALE_AMT
				,@VAT_SALE_AMT
				,@VAT_AMT
				,@NO_VAT_SALE_AMT
				,@NO_TAX_SALE_AMT
				,@RET_BILL_CNT
				,@RET_BILL_AMT
				,@VISIT_CST_CNT
				,@POS_READY_AMT
				,@POS_CSH_IN_AMT
				,@POS_CSH_OUT_AMT
				,@WEA_IN_CSH_AMT
				,@WEA_IN_CRD_AMT
				,@TK_GFT_SALE_CSH_AMT
				,@TK_GFT_SALE_CRD_AMT
				,@TK_FOD_SALE_CSH_AMT
				,@TK_FOD_SALE_CRD_AMT
				,@CASH_CNT
				,@CASH_AMT
				,@CASH_BILL_CNT
				,@CASH_BILL_AMT
				,@CRD_CARD_CNT
				,@CRD_CARD_AMT
				,@WES_CNT
				,@WES_AMT
				,@TK_GFT_CNT
				,@TK_GFT_AMT
				,@TK_FOD_CNT
				,@TK_FOD_AMT
				,@CST_POINT_CNT
				,@CST_POINT_AMT
				,@JCD_CARD_CNT
				,@JCD_CARD_AMT
				,@RFC_CNT
				,@RFC_AMT
				,@DC_GEN_CNT
				,@DC_GEN_AMT
				,@DC_SVC_CNT
				,@DC_SVC_AMT
				,@DC_JCD_CNT
				,@DC_JCD_AMT
				,@DC_CPN_CNT
				,@DC_CPN_AMT
				,@DC_CST_CNT
				,@DC_CST_AMT
				,@DC_TFD_CNT
				,@DC_TFD_AMT
				,@DC_PRM_CNT
				,@DC_PRM_AMT
				,@DC_CRD_CNT
				,@DC_CRD_AMT
				,@DC_PACK_CNT
				,@DC_PACK_AMT
				,@REM_CHECK_CNT
				,@REM_CHECK_AMT
				,@REM_W100000_CNT
				,@REM_W50000_CNT
				,@REM_W10000_CNT
				,@REM_W5000_CNT
				,@REM_W1000_CNT
				,@REM_W500_CNT
				,@REM_W100_CNT
				,@REM_W50_CNT
				,@REM_W10_CNT
				,@REM_CASH_AMT
				,@REM_TK_GFT_CNT
				,@REM_TK_GFT_AMT
				,@REM_TK_FOD_CNT
				,@REM_TK_FOD_AMT
				,@ETC_TK_FOD_AMT
				,@LOSS_CASH_AMT
				,@LOSS_TK_GFT_AMT
				,@LOSS_TK_FOD_AMT
				,@REPAY_CASH_CNT
				,@REPAY_CASH_AMT
				,@REPAY_TK_GFT_CNT
				,@REPAY_TK_GFT_AMT
				,@MCP_CNT
				,@MCP_AMT
				,@PCD_CARD_CNT
				,@PCD_CARD_AMT
				,@PPC_CARD_AMT
				,@PPC_CARD_CNT
				,@PPC_CARD_SALE_CSH_AMT
				,@PPC_CARD_SALE_CRD_AMT
				,@TAX_RFND_CNT
				,@TAX_RFND_AMT
				,@TAX_RFND_FEE
				,@DC_TAX_CNT
				,@DC_TAX_AMT
				,@O2O_CNT
				,@O2O_AMT
				,@EGIFT_CNT
				,@EGIFT_AMT
				,@SP_PAY_AMT
				,@SP_PAY_CNT
				,@DEPOSIT_AMT
				,@DEPOSIT_CNT
				,@REFUND_AMT
				,@REFUND_CNT
				,@SEND_FLAG
				,@SEND_DT
				,@INSERT_DT )

</OpenInterimShift>

<GetEmpFuncKey>
SELECT K.FK_NO	FROM MST_EMP_FUNC_KEY K	LEFT JOIN	MST_INFO_EMP E  
										ON			E.SHOP_CODE = K.SHOP_CODE
										AND			E.EMP_FLAG	= K.EMP_FLAG
				WHERE	E.SHOP_CODE = @SHOPCODE
				AND		E.EMP_NO	= @EMPNO
</GetEmpFuncKey>